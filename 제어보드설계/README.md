# 시스템 구조

## 시스템 블록도

1. 수로의 메인보드와 게이트웨이는 동일한 LoRa 통신 보드를 사용하여 통신한다.

2. 수로에서 게이트웨이로 온도&유량&압력 센서값과 배터리잔량, 발전량, 밸브값(닫힌 정도)을 전송한다. 
  게이트웨이에서는 USER가 조작한 밸브 제어명령을 수로에 전송한다.
3. 게이트웨이는 각 수로에서 모인 수로 데이터를 WiFi 통신으로 서버에 축적한다.

4. 라즈베리파이 보드는 일정 시간마다 서버에서 수로 데이터를 가져와 인공지능 고장 진단을 수행하고 진단 결과를 다시 서버에 전송한다.

5. 유저는 홈페이지 GUI 형태로 서버에 축적된 데이터를 확인하고 필요해 각 수로의 밸브값을 제어할 수 있다.


## 보드 블록도

1. 배터리(20~24V)의 전압이 모터드라이브에 공급되고 컨버터를 통해 5V로 다운되어 Nano 보드와 LoRa 보드에 공급된다. 

2. 보드의 LoRa보드에서 RS485통신을 통해 압력&유량&온도 센서값을 가져오고 수로 발전기의 발생 전압과 배터리 전압을 전압센서를 통해 가져온다. 
  이후 수집한 센서값과 전압값을 LoRa통신 안테나를 통해 게이트웨이 LoRa보드에게 전송한다.
  
3. Nano 보드는 전압센서을 통해 측정한 배터리 잔량과 발전량을 가져와 LCD 디스플레이에 출력한다. 
  또한 릴레이 모듈을 제어하여 수로 발전기가 동작할때는 수로 발전기와 배터리를 연결하고 그 외에는 태양광 발전기와 배터리를 연결하여 배터리를 충전시킨다.
  
4. 게이트웨이에서 밸브 제어 명령이 도착할 경우 LoRa보드에서 현재의 밸브값과 제어 명령이 지령하는 밸브값을 비교하여 필요한 횟수만큼 스텝모터를 회전시킨다.
